name: Lunalab
seed: 42
physics_dt: 0.0333 # 30 Hz
rendering_dt: 0.0333 # 30 Hz
enforce_realtime: true

lunalab_settings: # These settings cannot be changed.
  lab_length: 10.0
  lab_width: 6.5
  resolution: 0.01

# Rocks sampling parameters.
rocks_settings:
  instancers_path: /Lunalab/Rocks
  rocks_settings:
    large_rocks: # The name doesn't matter.
      seed: ${....seed}
      collections: ["lunalab_rocks"] # Where to get the rock models from.
      use_point_instancer: True # If True, the rocks will be instanced using the PointInstancer.
                                # If False, it will use the custom instancer that works for SDG.
      requests: # A list of request used to distribute the rocks.
        req_pos_xy:
          attribute: Position
          axes: ["x", "y"]
          layer:
            name: Image
            # data: Is loaded automatically from the DEM.
            mpp_resolution: ${.......lunalab_settings.resolution}
            output_space: 2
          sampler:
            name: HardCoreUniform
            randomization_space: 2
            seed: ${.......seed}
            core_radius: 0.5
            num_repeat: 2
            min: ${as_tuple:0.5,0.5}
            max: ${as_tuple:6,9.5}

        req_pos_z:
          attribute: Position
          axes: ["z"]
          layer:
            name: Image
            output_space: 1
          sampler:
            name: Image
            randomization_space: 1
            # resolution: Resolution is infered automatically from the loaded DEM.
            # data: Is loaded automatically from the DEM.
            mpp_resolution: ${.......lunalab_settings.resolution}

        req_random_z_rot:
          attribute: Orientation
          axes: ["x", "y", "z", "w"]
          layer:
            name: RollPitchYaw
            rmax: 0
            rmin: 0
            pmax: 0
            pmin: 0
            ymax: 6.28318530718
            ymin: 0
          sampler:
            name: Uniform
            randomization_space: 3
            seed: ${.......seed}

        req_scale:
          attribute: Scale
          axes: ["xyz"]
          layer:
            name: Line
            xmin: 1.0
            xmax: 1.0
          sampler:
            name: Uniform
            randomization_space: 1
            seed: ${.......seed}

terrain_manager:
  moon_yard:
    crater_generator:
      profiles_path: assets/Terrains/crater_spline_profiles.pkl
      min_xy_ratio: 0.85
      max_xy_ratio: 1.0
      resolution: ${....lunalab_settings.resolution}
      pad_size: 500
      random_rotation: True
      z_scale: 1.0
      seed: ${....seed}

    crater_distribution:
      x_size: 10.0
      y_size: 6.5
      densities: [0.025, 0.05, 0.5]
      radius: [[1.5,2.5],[0.75,1.5],[0.25,0.5]]
      num_repeat: 0
      seed: ${....seed}

    base_terrain_generator:
      x_size: ${....lunalab_settings.lab_length}
      y_size: ${....lunalab_settings.lab_width}
      resolution: ${....lunalab_settings.resolution}
      max_elevation: 0.25
      min_elevation: -0.025
      z_scale: 1.0
      seed: ${....seed}

    deformation_engine:
      enable: False
      delay: 2.0
      terrain_width: ${....lunalab_settings.lab_width}
      terrain_height: ${....lunalab_settings.lab_length}
      terrain_resolution: ${....lunalab_settings.resolution}
      footprint:
        width: 0.09
        height: 0.2
      deform_constrain:
        x_deform_offset: 0.0
        y_deform_offset: 0.0
        deform_decay_ratio: 0.01
      boundary_distribution:
        distribution: trapezoidal
        angle_of_repose: 1.047 #pi/3
      depth_distribution:
        distribution: trapezoidal
        wave_frequency: 4.14 # num_grouser/pi (no slip)
      force_depth_regression:
        amplitude_slope: 0.00006
        amplitude_intercept: 0.008
        mean_slope: -0.00046
        mean_intercept: -0.0013

    is_yard: False
    is_lab: True

  root_path: /Lunalab
  texture_path: /Lunalab/Looks/Basalt
  dems_path: Terrains/Lunalab
  mesh_position: [0, 0, 0]
  mesh_orientation: [0, 0, 0, 1] # Quaternion x,y,z,w
  mesh_scale: [1, 1, 1]
  sim_length: ${..lunalab_settings.lab_length}
  sim_width: ${..lunalab_settings.lab_width}
  resolution: ${..lunalab_settings.resolution}

# feel free to modify which robots to spawn
# see the commented out examples
robots_settings:
  uses_nucleus: False
  is_ROS2: True
  max_robots: 5
  robots_root: "/Robots"
  parameters:
    # -
    #   robot_name: ex1
    #   usd_path: assets/USD_Assets/robots/ex1.usd   # by the Space Robotics Laboratory of Tohoku University
    #   pose:
    #     position: [1.0, 1.0, 0.5]
    #     orientation: [1, 0, 0, 0]
    #   domain_id: 0
    #   target_links: ["left_front_wheel_link", "left_rear_wheel_link", "right_front_wheel_link", "right_rear_wheel_link"]

    # -
    #   robot_name: jackal
    #   # usd_path: assets/USD_Assets/robots/ros2_jackal_PhysX_vlp16_stereo.usd
    #   usd_path: assets/USD_Assets/robots/ros2_jackal_PhysX_vlp16.usd
    #   pose:
    #     position: [5.0, 5.0, 0.5]
    #     orientation: [1, 0, 0, 0]
    #   domain_id: 0
    #   target_links: ["front_left_wheel_link", "front_right_wheel_link", "rear_left_wheel_link", "rear_right_wheel_link"]
    # -
      # robot_name: husky
      # # usd_path: assets/USD_Assets/robots/ros2_husky_PhysX_vlp16.usd         
      # usd_path: assets/USD_Assets/robots/nograph_husky.usd     
      # # usd_path: assets/USD_Assets/robots/ros2_husky_PhysX_vlp16_mono_depth_imu.usd 
      # pose:
      #   position: [5.0, 5.0, 0.5]
      #   orientation: [1, 0, 0, 0]
      # domain_id: 0
      # target_links: ["front_left_wheel_link", "front_right_wheel_link", "rear_left_wheel_link", "rear_right_wheel_link"]
      # base_link: "base_link" # core link used to determine the position of the robot
      # wheel_joints:
      #   left: ["front_left_wheel", "rear_left_wheel"]
      #   right: ["front_right_wheel", "rear_right_wheel"]
      # camera:
      #   prim_path: "/Robots/husky/d455/RSD455/Camera_OmniVision_OV9782_Left"
      #   resolutions: 
      #     low: [320, 240]
      #     high: [1440, 1080]
      # imu_sensor_path: "/Robots/husky/d455/RSD455/Imu_Sensor"
    -
      robot_name: pragyaan
      usd_path: assets/USD_Assets/robots/pragyaan/nograph_pragyaan.usd  
      pose:
        position: [5.0, 5.0, 0.8]
        orientation: [0.5, 0.5, 0.5, 0.5]
      domain_id: 0
      target_links: [
        "Mobility/Wheel_front_left",
        "Mobility/Wheel_front_right",
        "Mobility/Wheel_middle_left",
        "Mobility/Wheel_middle_right",
        "Mobility/Wheel_back_left",
        "Mobility/Wheel_back_right"
      ]
      base_link: "base_link" # core link used to determine the position of the robot
      wheel_joints:
        left: ["wheel_fl", "wheel_ml", "wheel_bl"]
        right: ["wheel_fr", "wheel_mr", "wheel_br"]
      camera:
        prim_path: "/Robots/husky/Body/body_main/depth_cam"
        resolutions: 
          low: [320, 240]
          high: [1440, 1080]
      turn_speed_coef: 17
      solar_panel_joint: "solarJoint"  # finds it within the main robot articulation
  yamcs_tmtc:
    enabled: True
    address: "localhost:8090"
    instance: "workshop"
    processor: "realtime"
    intervals:
      robot_stats: 1
      camera_streaming: 2
    lander_camera:
      prim_path: "/StaticAssets/lander/Lander/Cam_Right/Lander_Camera"
      resolution: [1440, 1080]
    parameters:
      pose_of_base_link: "/Rover/pose_ground_truth"
      go_nogo: "/Rover/go_nogo"
      imu_accelerometer: "/Rover/imu_accelerometer"
      imu_gyroscope: "/Rover/imu_gyroscope"
      imu_orientation: "/Rover/imu_orientation"
      obc_state: "/Rover/obc_state"
      obc_cpu_usage: "/Rover/obc_cpu_usage"
      obc_ram_usage: "/Rover/obc_ram_usage"
      obc_disk_usage: "/Rover/obc_disk_usage"
      obc_uptime: "/Rover/obc_uptime"
      rssi: "/Rover/radio_rssi"
      temperature_front: "/Rover/temperature_front"
      temperature_back: "/Rover/temperature_back"
      temperature_left: "/Rover/temperature_left"
      temperature_right: "/Rover/temperature_right"
      temperature_top: "/Rover/temperature_top"
      temperature_bottom: "/Rover/temperature_bottom"
      temperature_elec_box: "/Rover/temperature_elec_box"
      battery_charge: "/Rover/battery_charge"
      battery_voltage: "/Rover/battery_voltage"
      total_current_in: "/Rover/total_current_in"
      total_current_out: "/Rover/total_current_out"
      motor_current: "/Rover/motor_current"
      current_draw_obc: "/Rover/current_draw_obc"
      current_draw_motor_controller: "/Rover/current_draw_motor_controller"
      current_draw_neutron_spectrometer: "/Rover/current_draw_neutron_spectrometer"
      current_draw_apxs: "/Rover/current_draw_apxs"
      current_draw_camera: "/Rover/current_draw_camera"
      current_draw_radio: "/Rover/current_draw_radio"
      current_draw_eps: "/Rover/current_draw_eps"
      neutron_counts: "/Rover/neutron_counts"
      camera_streaming_state: "/Rover/camera/images_streaming/state"
      solar_panel_state: "/Rover/solar_panel_state"
    commands:
      drive_straight: "/Rover/motor/drive_straight"
      drive_turn: "/Rover/motor/drive_turn"
      camera_capture_high: "/Rover/camera/camera_capture_high"
      camera_streaming_on_off: "/Rover/camera/camera_streaming"
      camera_capture_depth: "/Rover/camera/camera_capture_depth"
      solar_panel: "/Rover/system/deploy_solar_panel"
      power_electronics: "/Rover/power/power_electronics"
      go_nogo: "/Rover/system/go_nogo_command"
      capture_apxs: "/Rover/payload/payload_capture_apxs"
      admin_battery_percentage: "/Admin/admin_set_battery_percentage"
      admin_water_detection: "/Admin/admin_water_detection"
      admin_inject_fault: "/Admin/admin_inject_fault"
      lander_camera_capture_high: "/Lander/camera/lander_camera_capture"

static_assets_settings:
  root_path: "/StaticAssets"
  parameters:
    - asset_name: rock1
      usd_path: USD_Assets/rocks/lunalab_rocks/rock_1/rock1.usd
      pose:
        position: [5.0, 7.5, 0.0]
        orientation: [1, 0, 0, 1]
      collision: False

    - asset_name: lander
      usd_path: USD_Assets/rocks/lunalab_rocks/rock_2/rock2.usd
      pose:
        position: [5.0, 6.2, 0.0]
        orientation: [0, 0, 0, 1] 
      collision: True

monitoring_cameras_settings:
  root_path: "/MonitoringCameras"
  camera_definitions:
    - name: "corner"
      pose:
        position: [0.0, 0.0, 2.5]
        orientation: [0.493, -0.302, -0.169, 0.796]
      camera_params:
        focal_length: 1.93
        horizontal_aperture:  2.4
        vertical_aperture: 1.8
        fstop: 5.0
        focus_distance: 10.0
        clipping_range: [0.01, 1000000.0]
      ros2:
        enabled: False
        topic: "/monitoring/corner"
        frame_id: "corner_id"
      type: "Rgb" # make sure to have correct naming - eg. Rgb ; Depth ; SemanticSegmentation ; InstanceSegmentation ; Normals
      resolution: [1280, 720]  
      # stream_frequency: 2.0 #  every 0.5s - in order to not overwhelm the network
